<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>DreamNest</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>


  <main id="main">
  <div id="header"></div>
  <div id="page"></div>
  
    <!-- ======= Property Single ======= -->
    <section class="property-single nav-arrow-b">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div id="property-single-carousel" class="swiper">
              <img src="" alt="" id="main_img">
            </div>

        </div>

        <div class="row">
          <div class="col-sm-12">

            <div class="row justify-content-between">
              <div class="col-md-5 col-lg-4">
                <div class="property-price d-flex justify-content-center foo">
                  <div class="card-header-c d-flex">
                    <div class="card-box-ico">
                      <span class="bi bi-cash">&#2547;</span>
                    </div>
                    <div class="card-title-c align-self-center">
                      <h5 class="title-c" id="curent_price"></h5>
                    </div>
                    <div class="purchaseBTN pt-5">

                    </div>
                  </div>
                </div>
                <div class="property-summary">
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="title-box-d section-t4">
                        <h3 class="title-d">Location</h3>
                      </div>
                    </div>
                  </div>
                  <div class="summary-list" id="location">
                   
                  </div>
                </div>
                <div class="property-summary">
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="title-box-d section-t4">
                        <h3 class="title-d">Quick Summary</h3>
                      </div>
                    </div>
                  </div>
                  <div class="summary-list" id="details">
                    
                  </div>
                </div>
              </div>
              
            </div>
          </div>
          
          <div class="col-md-12">
            <div class="row section-t3">
              <div class="col-sm-12">
                <div class="title-box-d">
                  <h3 class="title-d">Reviews</h3>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="property-contact" id="review">
                 
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section><!-- End Property Single-->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <section class="section-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 col-md-4">
          <div class="widget-a">
            <div class="w-header-a">
              <h3 class="w-title-a text-brand">DreamNest</h3>
            </div>
            
            
          </div>
        </div>
        <div class="col-sm-12 col-md-4 section-md-t3">
          <div class="widget-a">
            <div class="w-header-a">
              <h3 class="w-title-a text-brand">The Company</h3>
            </div>
            <div class="w-body-a">
              <div class="w-body-a">
                <ul class="list-unstyled">
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Site Map</a>
                  </li>
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Legal</a>
                  </li>
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Agent Admin</a>
                  </li>
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Careers</a>
                  </li>
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Affiliate</a>
                  </li>
                  <li class="item-list-a">
                    <i class="bi bi-chevron-right"></i> <a href="#">Privacy Policy</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      
      </div>
    </div>
  </section>
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <nav class="nav-footer">
            <ul class="list-inline">
              <li class="list-inline-item">
                <a href="#">Home</a>
              </li>
              <li class="list-inline-item">
                <a href="#">About</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Property</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Blog</a>
              </li>
              <li class="list-inline-item">
                <a href="#">Contact</a>
              </li>
            </ul>
          </nav>
         
        </div>
      </div>
    </div>
  </footer><!-- End  Footer -->

  <!-- <div id="preloader"></div> -->
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
    <script>
      $(document).ready(function () {
         const loader = `<div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span> 
                  </div> <span class="pl-2">Loading...</span>`;
        function loadNavbar() {
          $.ajax({
            type: "GET",
            url: "http://localhost/rent_house_uiu/backend/api/v1/page-info/abh1522agwe522255hba514125/nav",
            dataType: "json",
            success: function (response) {
              $("#title").html(response.adi_data.appName);
              $("#appName").html(response.adi_data.appName);
              $("#header").html(response.msg);
            },
            error: function (error) {
              console.log("Error loading content:", error);
            }
          });
        }
        loadNavbar();
        function LoadData(){
          const productDetails = JSON.parse(localStorage.getItem('NextpathDetails'));
          const url = `http://localhost/rent_house_uiu/backend/api/v1/fetch_hous_details/abh1522agwe522255hba514125/${productDetails}`;
          $.ajax({
            type: "GET",
            url: url,
            dataType: "json",
            beforeSend: function () {
              $("#img_main").html(loader);
              $("#curent_price").html(loader);
              $("#location").html(loader);
              $("#details").html(loader);
              $("#review").html(loader);
            },
            success: function (response) {
            $("#img_main").html('');
            $("#curent_price").html('');
            $("#location").html('');
            $("#main_img").attr('src', response.data.main_img);
            $("#curent_price").html( response.data.price);
            $("#location").html( '<h4 class ="text-success">'+response.data.location+'</h4>');
            $("#details").html( '<h4 class ="text-success">'+response.data.details +'</h4>');
            $("#review").html(response.data.reviewHtml);
            const userData = JSON.parse(localStorage.getItem('homelyAuth'));

            if (userData && userData.accessToken) {
              if(userData.path =='user'){
                 if (response.data.type === 'rent') {
                  $('.purchaseBTN').html(`<button class="btn btn-primary take-rent" data-sl="${response.data.sl}">Take rent</button>`)
                } else {
                  $('.purchaseBTN').html(`<button class="btn btn-success take-sale" data-sl="${response.data.sl}">Buy this property</button>`)
                }
              }
            }
            },
            error: function (error) {
              console.log("Error loading content:", error);
            }
          });

        }
        LoadData();
        $(document).on('click', '.take-rent', function (e) {
          e.preventDefault();
          const userData = JSON.parse(localStorage.getItem('homelyAuth'));
          const accessToken = userData.accessToken;
          const email = userData.email;
          var slValue = $(this).data('sl');
          const price = parseInt($("#curent_price").text())
          const url = `http://localhost/rent_house_uiu/backend/api/v1/get_rent/abh1522agwe522255hba514125/${accessToken}/${email}`;
          const data = JSON.stringify({
            author: email,
            price: price,
            slValue: slValue,
          });
           $.ajax({
            url: url,
            type: 'POST',
            data: data,
            contentType: 'application/json',
            beforeSend: function () {
              $("#take-rent").attr("disabled", "disabled");
              $("#take-rent").html("Please Wait");
            },
            success: function (response) {
              if(response.exception === 'yes'){
                 alert(response.msg);
              }else{
                alert(response.msg);
                window.location.href = response.url;
                console.log(response);
              }
            },
            error: function (error) {
              console.error(error);
            }
          });
        });
        $(document).on('click', '.take-sale', function (e) {
          e.preventDefault();
           const userData = JSON.parse(localStorage.getItem('homelyAuth'));
          const accessToken = userData.accessToken;
          const email = userData.email;
          var slValue = $(this).data('sl');
          const price = parseInt($("#curent_price").text())
          const url = `http://localhost/rent_house_uiu/backend/api/v1/get_sale/abh1522agwe522255hba514125/${accessToken}/${email}`;
          const data = JSON.stringify({
            author: email,
            price: price,
            slValue: slValue,
          });
          $.ajax({
            url: url,
            type: 'POST',
            data: data,
            contentType: 'application/json',
            beforeSend: function () {
              $("#take-rent").attr("disabled", "disabled");
              $("#take-rent").html("Please Wait");
            },
            success: function (response) {
              if (response.exception === 'yes') {
                alert(response.msg);
              } else {
                alert(response.msg);
                window.location.href = response.url;
                console.log(response);
              }
            },
            error: function (error) {
              console.error(error);
            }
          });
        });
      });
    </script>

</body>

</html>